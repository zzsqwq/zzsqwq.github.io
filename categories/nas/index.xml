<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:content="http://purl.org/rss/1.0/modules/content/">
  <channel>
    <title>NAS on Zs&#39;s Blog</title>
    <link>https://blog.zzsqwq.cn/categories/nas/</link>
    <description>Recent content in NAS on Zs&#39;s Blog</description>
    <follow_challenge>
      <feedId>62734001391548416</feedId>
      <userId>62689941916008448</userId>
    </follow_challenge>
    <generator>Hugo -- 0.141.0</generator>
    <language>en</language>
    <lastBuildDate>Thu, 05 Dec 2024 00:08:00 +0800</lastBuildDate>
    <atom:link href="https://blog.zzsqwq.cn/categories/nas/index.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>绿联 NAS 配置基于 EUI64 的 SLAAC IPv6 地址</title>
      <link>https://blog.zzsqwq.cn/posts/ugreen-nas-configure-eui64-ipv6/</link>
      <pubDate>Thu, 05 Dec 2024 00:08:00 +0800</pubDate>
      <guid>https://blog.zzsqwq.cn/posts/ugreen-nas-configure-eui64-ipv6/</guid>
      <description>&lt;p&gt;最近在玩 PT 站，家里没有公网 IPv4 地址但有公网 IPv6 地址，绿联 NAS 上挂的 qBittorrent 需要靠 IPv6 刷上传量。&lt;/p&gt;
&lt;p&gt;但是一般来说 IPv6 的地址都是随机生成的，不好在 OpenWrt 配置防火墙规则放行对应设备地址和端口，如果全部放行又过于危险，所以需要找到一种可以固定放行对应的设备地址和端口的方法。&lt;/p&gt;
&lt;p&gt;参考 &lt;a href=&#34;https://www.youtube.com/watch?v=klQ6JbZEeJ0&amp;amp;list=PL5TbbtexT8T293fBi4i5MOf4OjdLQ3hUa&amp;amp;index=6&#34;&gt;不良林的 IPv6 配置视频&lt;/a&gt; 可以找到一种组合：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;SLAAC 的方式下发 IPv6 地址&lt;/li&gt;
&lt;li&gt;设备端配置 EUI64 模式生成后缀&lt;/li&gt;
&lt;li&gt;防火墙通行规则匹配特定后缀放行&lt;sup id=&#34;fnref:1&#34;&gt;&lt;a href=&#34;#fn:1&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;1&lt;/a&gt;&lt;/sup&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;第一点和第三点在视频中讲的都很清楚，主要是第二点，其中 Windows、Mac、和基于 NetworkManager 的 Linux 都可以很方便的在网上找到教程更改，但是绿联的 NAS 使用的 UGOS Pro 系统并不基于 NetworkManager，需要配置 systemd-networkd，具体步骤如下：&lt;/p&gt;
&lt;p&gt;首先配置绿联 NAS 打开 SSH 端口，然后通过 ssh 用具有管理权的帐号登陆到终端&lt;/p&gt;
&lt;p&gt;&lt;img alt=&#34;open-ssh&#34; loading=&#34;lazy&#34; src=&#34;https://blog.zzsqwq.cn/images/configure-ugreen-nas-eui64/open-ssh.png&#34;&gt;&lt;/p&gt;
&lt;p&gt;编辑配置网络文件，文件放到 &lt;code&gt;/etc/systemd/network/&lt;/code&gt; 下，注意你使用的 LAN 口，如果是 LAN1 的话接口对应 &lt;code&gt;eth0&lt;/code&gt;，如果是 LAN2 的话接口对应 &lt;code&gt;eth1&lt;/code&gt;，我这里用的是 LAN1&lt;/p&gt;
&lt;p&gt;&lt;img alt=&#34;lan1&#34; loading=&#34;lazy&#34; src=&#34;https://blog.zzsqwq.cn/images/configure-ugreen-nas-eui64/lan1.png&#34;&gt;&lt;/p&gt;
&lt;p&gt;在此目录下创建 &lt;code&gt;10-eth0.network&lt;/code&gt; 文件，使用 nano 或 vim 编辑文件，内容如下&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;Match&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;Name&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;eth0  &lt;span class=&#34;c1&#34;&gt;# 替换为你的网络接口名称&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;Network&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;IPv6AcceptRA&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;yes  &lt;span class=&#34;c1&#34;&gt;# 接受路由通告&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;IPv6AcceptRA&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;UseAutonomousPrefix&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;yes
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;UseTemporaryAddress&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;no
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;Link&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;IPv6Token&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;::eui64  &lt;span class=&#34;c1&#34;&gt;# 设置为 EUI-64 地址生成方式&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;保存后重启对应服务即可&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sudo systemctl restart systemd-networkd
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;然后通过 &lt;code&gt;ip addr show eth0&lt;/code&gt; 可以查看到已经通过 eui64 方式生成 IPv6 地址后缀&lt;/p&gt;
&lt;p&gt;&lt;img alt=&#34;success&#34; loading=&#34;lazy&#34; src=&#34;https://blog.zzsqwq.cn/images/configure-ugreen-nas-eui64/eui64.png&#34;&gt;&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;补充：&lt;/p&gt;
&lt;p&gt;后续使用发现绿联每次启动的时候并不会遵守 systemd-networkd 的这个设定，所以还是会自动生成一个 stable-privacy 地址，因此需要每次开启重启一下 systemd-networkd。&lt;/p&gt;
&lt;p&gt;绿联 NAS 的 rc.local 文件是自动生成的，所以不建议在里面修改会被自动覆盖，使用 crontab 在 root 用户下添加重启任务即可。&lt;/p&gt;
&lt;p&gt;首先 &lt;code&gt;sudo -i&lt;/code&gt; 切换到 root 用户，然后使用 &lt;code&gt;crontab -e&lt;/code&gt; 打开定时任务编辑文件，向其中添加：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;@reboot systemctl restart systemd-networkd
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;然后重启系统验证只存在 eui64 地址&lt;/p&gt;
&lt;div class=&#34;footnotes&#34; role=&#34;doc-endnotes&#34;&gt;
&lt;hr&gt;
&lt;ol&gt;
&lt;li id=&#34;fn:1&#34;&gt;
&lt;p&gt;&lt;a href=&#34;https://www.v2ex.com/t/1004926&#34;&gt;https://www.v2ex.com/t/1004926&lt;/a&gt;&amp;#160;&lt;a href=&#34;#fnref:1&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;
</description>
    </item>
  </channel>
</rss>
